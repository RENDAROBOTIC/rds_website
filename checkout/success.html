<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - R Design Supply</title>
    <link rel="stylesheet" href="/style_sheet/styles.css">
    <style>
        .success-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .success-icon {
            color: #4CAF50;
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .success-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .success-message {
            font-size: 16px;
            margin-bottom: 30px;
            color: #666;
            line-height: 1.5;
        }
        
        .continue-shopping {
            display: inline-block;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .continue-shopping:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <a href="/renda_design_supply.html">
                <img src="https://res.cloudinary.com/ds4bmw1nd/image/upload/f_auto/q_auto/v1756387201/rds_logo_hbqnog.png" alt="Renda Design Supply">
            </a>
        </div>
        <nav>
            <ul>
                <li><a href="/tools/tools.html">Tools</a></li>
                <li><a href="/n&t/n&t.html">Notions ✚ Trims</a></li>
                <li><a href="/f&l/f&l.html">Fabric ✚ Leather</a></li>
                <li><a href="/designer-resources/designer-resources.html">Designer Resources</a></li>
                <li><a href="/support/support.html">Support</a></li>
            </ul>
        </nav>
        <div class="search-cart">
            <form id="searchForm" action="../search/search-results.html" method="get">
                <input type="text" id="searchInput" name="q" placeholder="">
                <button type="submit"></button>
            </form>
            <div class="cart-link">
                <a href="/checkout/cart.html">
                    <img src="https://res.cloudinary.com/ds4bmw1nd/image/upload/f_auto/q_auto/cart.png" alt="Cart">
                </a>
            </div>
        </div>
    </header>

    <main>
        <div class="success-container">
            <div class="success-icon">✓</div>
            <h1 class="success-title">Thank You for Your Order!</h1>
            <p class="success-message">
                Your payment was successful and your order has been placed.<br>
                You will receive an email confirmation shortly with your order details.
            </p>
            
            <div id="order-summary" style="text-align: left; margin: 30px 0; padding: 20px; background: white; border-radius: 8px; border: 1px solid #ddd;">
                <h3>Order Summary</h3>
                <div id="order-details">
                    <!-- Order details will be populated here -->
                </div>
            </div>
            
            <a href="/renda_design_supply.html" class="continue-shopping">Continue Shopping</a>
        </div>
    </main>

    <footer>
        <p>RDS. &copy; 2025</p>
    </footer>

    <script>
        // Display order summary and clear cart after successful Stripe payment
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Get session_id from URL parameter
                const urlParams = new URLSearchParams(window.location.search);
                const sessionId = urlParams.get('session_id');
                
                if (sessionId) {
                    console.log('Payment successful with session:', sessionId);
                    
                    // Get order details from localStorage
                    const cartData = localStorage.getItem('cartItems');
                    if (cartData) {
                        const items = JSON.parse(cartData);
                        const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                        
                        displayOrderSummary({
                            items: items,
                            subtotal: subtotal,
                            sessionId: sessionId
                        });
                    }
                    
                    // Clear cart after successful purchase
                    localStorage.removeItem('cartItems');
                    localStorage.removeItem('currentOrder');
                    console.log('Cart cleared after successful Stripe payment');
                } else {
                    // Fallback for demo orders without Stripe session
                    const orderData = localStorage.getItem('currentOrder');
                    if (orderData) {
                        const order = JSON.parse(orderData);
                        displayOrderSummary(order);
                        localStorage.removeItem('cartItems');
                        localStorage.removeItem('currentOrder');
                    } else {
                        // No order found, redirect to home
                        console.log('No order found, redirecting...');
                        setTimeout(() => {
                            window.location.href = '/renda_design_supply.html';
                        }, 2000);
                    }
                }
            } catch (e) {
                console.error('Error processing order:', e);
            }
        });

        function displayOrderSummary(order) {
            const container = document.getElementById('order-details');
            
            let itemsHtml = '';
            order.items.forEach(item => {
                const displaySize = item.size || item.sizeDisplay || 'Standard';
                const displayColor = item.color && item.color !== 'N/A' ? item.color : null;
                
                itemsHtml += `
                    <div style="margin: 10px 0; padding: 10px; border-bottom: 1px solid #eee;">
                        <strong>${item.name}</strong><br>
                        <small>${displaySize}${displayColor ? ', Color: ' + displayColor : ''}</small><br>
                        Quantity: ${item.quantity} × $${item.price.toFixed(2)} = $${(item.price * item.quantity).toFixed(2)}
                    </div>
                `;
            });
            
            let summaryHtml = `
                ${itemsHtml}
                <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #333;">
                    <p><strong>Subtotal:</strong> $${order.subtotal.toFixed(2)}</p>
                    <p><em>Tax and delivery were calculated and processed through Stripe</em></p>
            `;
            
            if (order.sessionId) {
                summaryHtml += `<p style="font-size: 12px; color: #999; margin-top: 10px;">Order ID: ${order.sessionId}</p>`;
            }
            
            summaryHtml += `</div>`;
            
            container.innerHTML = summaryHtml;
        }
    </script>
</body>
</html>